# Created Jotne 2021 v1.4
#
# This scripts converts all DHCP release to static automatically
# It should run on all routerOS version

/ip dhcp-server lease
# Test if this is a Bound session and the lease is a dynamic one. Do not change older reservation
:if (($leaseBound=1) && ([find where dynamic mac-address=$leaseActMAC]!="")) do={

	# Get the lease number
	:local Lease [find mac-address=$leaseActMAC]
	
	# Get date and time
	:local date [/system clock get date]
	:local time [/system clock get time]
	
	# Make the lease static	
	make-static $Lease

	# Get host name
	:local Name [get $Lease host-name ] 
	
	# Add date and time as a comment to show when it was seen first time	
	#comment comment="$date $time $Name" $Lease
	
	# Send a message to the log	
	:log info message="script=dhcp_static server=$leaseServerName IP=$leaseActIP MAC=$leaseActMAC name=$Name"
}